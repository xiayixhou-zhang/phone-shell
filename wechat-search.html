<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>搜索聊天内容</title>
  <style>
    /* 1. 基础样式还原 (保持第一张图的质感) */
    body { margin: 0; background-color: #f1f1f1; font-family: -apple-system, sans-serif; overflow-x: hidden; }
    .search-header { background: #ededed; padding: 8px 15px; display: flex; align-items: center; gap: 12px; position: sticky; top: 0; z-index: 100; }
    .search-box-wrapper { flex: 1; background: #fff; height: 36px; border-radius: 6px; display: flex; align-items: center; padding: 0 10px; }
    .search-input { border: none; outline: none; width: 100%; font-size: 17px; caret-color: #07c160; }
    .cancel-btn { color: #576b95; font-size: 17px; text-decoration: none; white-space: nowrap; cursor: pointer; }

    /* 2. 快速搜索分类样式 */
    .quick-search-container { display: flex; flex-direction: column; align-items: center; padding-top: 50px; }
    .quick-title { color: #b2b2b2; font-size: 14px; margin-bottom: 25px; }
    .grid { display: grid; grid-template-columns: repeat(3, 1fr); width: 100%; text-align: center; }
    .grid-item { color: #576b95; font-size: 16px; position: relative; padding: 5px 0; cursor: pointer; }
    .grid-item:not(:last-child)::after { content: ""; position: absolute; right: 0; top: 20%; height: 60%; width: 1px; background-color: #d8d8d8; }

    /* 3. 搜索结果区域 */
    #results-area { margin-top: 10px; }
    .message-item { background: #fff; padding: 12px 15px; border-bottom: 0.5px solid #eee; }
    .msg-time { font-size: 12px; color: #b2b2b2; margin-bottom: 4px; }
    .msg-text { font-size: 16px; color: #000; word-break: break-all; }
    .highlight { color: #07c160; font-weight: bold; } /* 搜索关键词高亮 */
    
    .hidden { display: none; }
    .empty-tip { text-align: center; color: #b2b2b2; margin-top: 50px; font-size: 14px; }
  </style>
</head>
<body>

  <div class="search-header">
    <div class="search-box-wrapper">
      <input type="text" id="searchInput" class="search-input" placeholder="搜索" autofocus>
    </div>
    <div class="cancel-btn" onclick="clearSearch()">取消</div>
  </div>

  <div id="navContainer" class="quick-search-container">
    <div class="quick-title">快速搜索聊天内容</div>
    <div class="grid">
      <div class="grid-item" onclick="searchByType('date')">日期</div>
      <div class="grid-item" onclick="searchByType('image')">图片与视频</div>
      <div class="grid-item" onclick="searchByType('link')">链接</div>
    </div>
  </div>

  <div id="results-area"></div>

<script>
  /* 假设你的聊天数据存放在 localStorage 里的 'chat_history' 键下
     数据格式大概是: [{role: 'user', content: '你好', time: '2023-10-01 12:00'}, ...]
  */
  
  const searchInput = document.getElementById('searchInput');
  const navContainer = document.getElementById('navContainer');
  const resultsArea = document.getElementById('resultsArea');

  // 获取数据的函数（你需要根据你实际的存储逻辑修改这里）
  function getChatHistory() {
    const data = localStorage.getItem('chat_history'); // 修改成你存聊天记录的那个 key
    return data ? JSON.parse(data) : [];
  }

  // 渲染结果
  function renderResults(list, keyword = '') {
    if (list.length === 0) {
      document.getElementById('results-area').innerHTML = '<div class="empty-tip">未找到相关聊天记录</div>';
      return;
    }

    const html = list.map(msg => {
      let displayContent = msg.content;
      // 如果有关键词，做个高亮处理
      if (keyword) {
        displayContent = displayContent.replace(new RegExp(keyword, 'gi'), match => `<span class="highlight">${match}</span>`);
      }
      return `
        <div class="message-item">
          <div class="msg-time">${msg.time || ''}</div>
          <div class="msg-text">${displayContent}</div>
        </div>
      `;
    }).join('');
    
    document.getElementById('results-area').innerHTML = html;
  }

  // 1. 文字搜索逻辑
  searchInput.addEventListener('input', (e) => {
    const val = e.target.value.trim();
    if (val) {
      navContainer.classList.add('hidden');
      const history = getChatHistory();
      const filtered = history.filter(m => m.content.toLowerCase().includes(val.toLowerCase()));
      renderResults(filtered, val);
    } else {
      clearSearch();
    }
  });

  // 2. 分类搜索逻辑
  function searchByType(type) {
    navContainer.classList.add('hidden');
    const history = getChatHistory();
    let filtered = [];

    if (type === 'link') {
      // 匹配包含 http 的内容
      filtered = history.filter(m => m.content.includes('http') || m.content.includes('www.'));
      searchInput.placeholder = "正在搜索链接...";
    } else if (type === 'image') {
      // 匹配包含图片标识的内容（取决于你存图片的方式，比如 <img> 或 markdown）
      filtered = history.filter(m => m.content.includes('![image]') || m.content.includes('<img'));
      searchInput.placeholder = "正在搜索图片与视频...";
    } else if (type === 'date') {
      // 日期搜索通常是弹出一个日期选择器，这里简单处理：显示所有带日期的消息
      filtered = history; 
      alert("点击了日期：这里通常可以根据你的需求弹出具体日期选择");
    }

    renderResults(filtered);
  }

  // 3. 取消/清空
  function clearSearch() {
    searchInput.value = '';
    searchInput.placeholder = '搜索';
    navContainer.classList.remove('hidden');
    document.getElementById('results-area').innerHTML = '';
  }
</script>

</body>
</html>
