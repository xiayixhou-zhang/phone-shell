<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>æˆ‘ä»¬çš„å°æ—¥å† â™¡</title>
  <style>
    body { font-family: "Arial", sans-serif; background-color: #fff0f5; color: #333; margin: 0; padding: 0; }
    h1 { text-align: center; padding: 20px; color: #ff69b4; }
    #calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; padding: 10px; max-width: 420px; margin: auto; }
    .day { padding: 10px; background: #ffe4f2; border-radius: 8px; text-align: center; cursor: pointer; }
    .today { background: #ffb6c1; font-weight: bold; }
    .special { border: 2px solid #ff1493; }
    .note-dot { display: block; width: 6px; height: 6px; background: #ff1493; border-radius: 50%; margin: 4px auto 0; }
    .header { grid-column: span 7; text-align: center; font-weight: bold; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>æˆ‘ä»¬çš„å°æ—¥å† â™¡</h1>
  <div class="header" id="monthHeader"></div>
  <div id="calendar"></div>

  <script>
    const loveStartDate = new Date("2025-07-22");
    const yourBirthday = "10-23";
    const myBirthday = "07-22";
    const periodStartDate = new Date("2026-02-02");
    const periodCycle = 28;
    const festivalMap = {
      "02-14": "æƒ…äººèŠ‚",
      "12-31": "å¹´ä¸‰å",
      "01-01": "å…ƒæ—¦",
      "10-23": "å®å®ç”Ÿæ—¥",
      "07-22": "å“¥å“¥ç”Ÿæ—¥",
      "02-10": "é™¤å¤•",
      "02-11": "æ˜¥èŠ‚",
      "02-24": "å…ƒå®µèŠ‚"
    };

    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth(); // 0-based
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const calendar = document.getElementById("calendar");

    document.getElementById("monthHeader").innerText = `${year}å¹´ ${month + 1}æœˆ`;

    // å ä½ç©ºæ ¼
    for (let i = 0; i < firstDay.getDay(); i++) {
      const blank = document.createElement("div");
      calendar.appendChild(blank);
    }

    for (let i = 1; i <= lastDay.getDate(); i++) {
      const dateObj = new Date(year, month, i);
      const div = document.createElement("div");
      const key = `${String(month+1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
      div.className = "day";

      // é«˜äº®ä»Šå¤©
      if (
        i === today.getDate() &&
        month === today.getMonth() &&
        year === today.getFullYear()
      ) {
        div.classList.add("today");
      }

      // æ ‡è®°èŠ‚æ—¥
      if (festivalMap[key]) {
        div.classList.add("special");
        div.title = festivalMap[key];
      }

      // ç‚¹å¼€è®°å½•
      div.innerHTML = `${i}`;
      const note = localStorage.getItem(`note-${year}-${key}`);
      if (note) {
        const dot = document.createElement("span");
        dot.className = "note-dot";
        div.appendChild(dot);
      }

      div.onclick = () => {
        const note = prompt(`å†™ä¸‹ä½ å¯¹ ${month + 1}æœˆ${i}æ—¥ çš„å°è®°å§ï½`);
        if (note !== null) {
          localStorage.setItem(`note-${year}-${key}`, note);
          alert("å®è´è®°å½•å¥½äº† â™¡");
          location.reload();
        }
      };

      calendar.appendChild(div);
    }

    // åœ¨ä¸€èµ·çºªå¿µæ—¥ï¼ˆåœ¨ä»Šå¤©ä¸‹æ–¹å¼¹çª—æç¤ºï¼‰
    const loveDays = Math.floor((today - loveStartDate) / (1000 * 60 * 60 * 24));
    const msg = document.createElement("div");
    msg.style.textAlign = "center";
    msg.style.padding = "10px";
    msg.innerHTML = `ğŸ’— æˆ‘ä»¬å·²ç»åœ¨ä¸€èµ· <strong>${loveDays}</strong> å¤©å•¦~`;

    // ä¸‹æ¬¡å§¨å¦ˆé¢„æµ‹
    const daysSinceLast = Math.floor((today - periodStartDate) / (1000 * 60 * 60 * 24));
    const nextPeriodIn = periodCycle - (daysSinceLast % periodCycle);
    const nextPeriodDate = new Date(today.getTime() + nextPeriodIn * 86400000);
    msg.innerHTML += `<br>ğŸ©¸ å®è´ä¸‹æ¬¡å§¨å¦ˆé¢„è®¡åœ¨ï¼š<strong>${nextPeriodDate.toLocaleDateString()}</strong>`;

    document.body.appendChild(msg);
  </script>
</body>
</html>
