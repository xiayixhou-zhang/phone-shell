<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>æˆ‘çš„å°æ‰‹æœº</title>
  <link rel="stylesheet" href="./styles.css" />
  <style>
    /* å¼ºåŠ›ä¿®å¤å¸ƒå±€ä¸ Ins é£æ ·å¼ */
    :root { --ios-radius: 18px; }
   Â 
    body { margin: 0; padding: 0; background: #f5f5f7; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica; }
   Â 
    .screen {
      position: relative;
      width: 100vw; height: 100vh;
      background-size: cover;
      background-position: center;
      display: flex; flex-direction: column;
    }

    /* é¡¶éƒ¨å¡ç‰‡å±…ä¸­ */
    .top-card {
      margin: 60px 20px 20px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border-radius: 25px;
    }

    /* å›¾æ ‡çŸ©é˜µå¯¹é½ */
    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      padding: 20px;
      justify-items: center;
    }

    .app {
      display: flex; flex-direction: column;
      align-items: center; text-decoration: none; color: #333;
    }

    .icon-wrapper {
      width: 60px; height: 60px;
      border-radius: var(--ios-radius);
      background: #fff;
      display: flex; align-items: center; justify-content: center;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .icon-wrapper img { width: 100%; height: 100%; object-fit: cover; }
    .app-label { font-size: 11px; margin-top: 6px; font-weight: 500; }

    /* åº•éƒ¨ Dock æ  */
    .dock {
      position: absolute; bottom: 20px; left: 20px; right: 20px;
      height: 85px; background: rgba(255, 255, 255, 0.4);
      backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
      border-radius: 30px; display: flex; align-items: center; justify-content: center;
    }

    .dock-content { display: flex; gap: 15px; }

    /* è®¾ç½®å¼¹çª—æ ·å¼ */
    .modal {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.3); z-index: 1000; align-items: flex-end;
    }
    .modal.active { display: flex; }
    .modal-content {
      width: 100%; background: white; border-radius: 30px 30px 0 0;
      padding: 25px; box-sizing: border-box; transform: translateY(100%); transition: 0.3s ease-out;
    }
    .modal.active .modal-content { transform: translateY(0); }
    .s-item {
      background: #f9f9f9; border-radius: 12px; padding: 12px;
      margin: 10px 0; display: flex; justify-content: space-between; align-items: center;
    }
  </style>
</head>
<body>
 Â 
  <div class="screen">
   Â 
    <div class="top-card">
      <div style="font-size: 20px; font-weight: bold;">çŒ«çŒ«</div>
      <div id="countdown-display" style="font-size: 13px; color: #666; margin-top: 5px;">ä»Šå¤©å¿ƒæƒ…ï¼šğŸ©·</div>
    </div>

    <div class="grid">
      <div class="app" onclick="openSettings()">
        <div class="icon-wrapper"><img src="./weather.png" id="main-weather" alt="å¤©æ°”"></div>
        <div class="app-label">å¤©æ°”</div>
      </div>
      </div>

    <div class="dock">
      <div class="dock-content">
        <a class="app" href="diary.html">
          <div class="icon-wrapper"><img src="./diary.png" id="dock-diary" alt="æ—¥è®°"></div>
        </a>
        <a class="app" href="memory.html">
          <div class="icon-wrapper"><img src="./memory.png" id="dock-memory" alt="è®°å¿†"></div>
        </a>
        <a class="app" href="calendar.html">
          <div class="icon-wrapper"><img src="./calendar.png" id="dock-calendar" alt="æ—¥å†"></div>
        </a>
        <div class="app" onclick="openSettings()">
          <div class="icon-wrapper"><img src="./settings.png" id="dock-settings" alt="è®¾ç½®"></div>
        </div>
      </div>
    </div>

  </div>

  <div id="settings-modal" class="modal" onclick="if(event.target==this) closeSettings()">
    <div class="modal-content">
      <h3 style="margin-top:0;">ç³»ç»Ÿè®¾ç½®</h3>
     Â 
      <div class="s-item">
        <span>æˆ‘çš„ç”Ÿæ—¥</span>
        <input type="date" id="set-birthday">
      </div>

      <div class="s-item">
        <span>æ›´æ¢å›¾æ ‡</span>
        <select id="app-selector">
          <option value="diary">æ—¥è®°</option>
          <option value="memory">è®°å¿†åº“</option>
          <option value="calendar">æ—¥å†</option>
          <option value="settings">è®¾ç½®</option>
          <option value="weather">å¤©æ°”</option>
        </select>
        <input type="file" id="icon-upload" accept="image/*" style="width:70px;">
      </div>

      <button onclick="saveAndClose()" style="width:100%; padding:15px; border-radius:15px; border:none; background:#007AFF; color:white; font-weight:bold; margin-top:10px;">å®Œæˆ</button>
    </div>
  </div>

  <script>
    function openSettings() { document.getElementById('settings-modal').classList.add('active'); }
    function closeSettings() { document.getElementById('settings-modal').classList.remove('active'); }

    // æ ¸å¿ƒï¼šå¤„ç†å›¾ç‰‡ä¸Šä¼ å¹¶é˜²æ­¢æ‰å›¾
    function saveAndClose() {
      const app = document.getElementById('app-selector').value;
      const file = document.getElementById('icon-upload').files[0];
      const bday = document.getElementById('set-birthday').value;

      if(bday) localStorage.setItem('user-bday', bday);

      if(file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const b64 = e.target.result;
          localStorage.setItem('icon-' + app, b64);
          // åŒæ­¥æ›´æ–°ä¸»å±å¹•å’Œ Dock
          if(document.getElementById('main-'+app)) document.getElementById('main-'+app).src = b64;
          if(document.getElementById('dock-'+app)) document.getElementById('dock-'+app).src = b64;
        };
        reader.readAsDataURL(file);
      }
      closeSettings();
      checkBirthday();
    }

    // æ£€æŸ¥ç”Ÿæ—¥å¹¶æé†’
    function checkBirthday() {
      const bday = localStorage.getItem('user-bday');
      if(bday) {
        const today = new Date().toISOString().slice(5,10); // å– MM-DD
        const birth = bday.slice(5,10);
        if(today === birth) {
          document.getElementById('countdown-display').innerText = "ğŸ‚ ç”Ÿæ—¥å¿«ä¹ï¼Œå°ä¸»äººï¼";
        }
      }
    }

    // åŠ è½½ä¿å­˜çš„å›¾æ ‡
    window.onload = function() {
      ['diary','memory','calendar','settings','weather'].forEach(app => {
        const saved = localStorage.getItem('icon-' + app);
        if(saved) {
          if(document.getElementById('main-'+app)) document.getElementById('main-'+app).src = saved;
          if(document.getElementById('dock-'+app)) document.getElementById('dock-'+app).src = saved;
        }
      });
      checkBirthday();
    };
  </script>
</body>
</html>
